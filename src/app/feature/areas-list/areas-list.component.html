<div class="main-container" #focus>
  <div class="header">
    <div class="title">
      <h2 class="mat-h2 primary-color">Çalışma Yerleri Listesi</h2>
      <h4>Yeni çalışma yeri ekleyebilirsiniz veya mevcut çalışma yerlerini düzenleyebilirsiniz.</h4>
    </div>
    <button mat-raised-button color="primary" (click)="onNewAreaClick()">Yeni Çalışma Yeri Oluştur</button>
  </div>
  <mat-divider></mat-divider>
  <div class="filter">
    <div class="filter-content">
      <mat-form-field appearance="outline">
        <mat-label>Tesis</mat-label>
        <mat-select
          [disabled]="loading"
          [(ngModel)]="filterFacility"
          (selectionChange)="onFilterFacilityChanged($event)"
        >
          <mat-option value="">--- Tüm Tesisler ---</mat-option>
          <mat-option *ngFor="let facility of facilities" [value]="facility.id">{{ facility.name }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Alan</mat-label>
        <mat-select
          [disabled]="loading"
          [(ngModel)]="filterAreaGroup"
          (selectionChange)="onFilterAreaGroupChanged($event)"
        >
          <mat-option value="">--- Tüm Alanlar ---</mat-option>
          <mat-option *ngFor="let areaGroup of facilityAreaGroups" [value]="areaGroup.code">{{
            areaGroup.name
          }}</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <mat-spinner color="primary" [diameter]="16" *ngIf="loading"></mat-spinner>
  </div>
  <div class="table-container single-tab" *ngIf="tableDs">
    <mat-table class="table-striped desktop" matSort (matSortChange)="onSortChanged($event)" [dataSource]="tableDs">
      <ng-container matColumnDef="id">
        <mat-header-cell *matHeaderCellDef class="w-56" mat-sort-header>ID</mat-header-cell>
        <mat-cell *matCellDef="let item" class="w-56">
          <span> {{ item.id }} </span>
        </mat-cell>
      </ng-container>
      <ng-container matColumnDef="facility">
        <mat-header-cell *matHeaderCellDef mat-sort-header>Tesis</mat-header-cell>
        <mat-cell *matCellDef="let item">
          <span> {{ item.facility }} </span>
        </mat-cell>
      </ng-container>
      <ng-container matColumnDef="areaGroup">
        <mat-header-cell *matHeaderCellDef mat-sort-header>Alan</mat-header-cell>
        <mat-cell *matCellDef="let item">
          <span> {{ item.areaGroup }} </span>
        </mat-cell>
      </ng-container>
      <ng-container matColumnDef="name">
        <mat-header-cell *matHeaderCellDef mat-sort-header>Çalışma Yeri</mat-header-cell>
        <mat-cell *matCellDef="let item">
          <span> {{ item.name }} </span>
        </mat-cell>
      </ng-container>
      <ng-container matColumnDef="qrCode">
        <mat-header-cell *matHeaderCellDef>QR Kodu</mat-header-cell>
        <mat-cell *matCellDef="let item">
          <span>
            <button mat-icon-button color="primary" (click)="onViewQrClick(item)">
              <mat-icon>qr_code</mat-icon>
            </button>
          </span>
        </mat-cell>
      </ng-container>
      <ng-container matColumnDef="action">
        <mat-header-cell *matHeaderCellDef class="w-56">&nbsp;</mat-header-cell>
        <mat-cell *matCellDef="let item" class="w-56">
          <button mat-icon-button [matMenuTriggerFor]="actions" [matMenuTriggerData]="{item}" color="accent">
            <mat-icon>more_vert</mat-icon>
          </button>
        </mat-cell>
      </ng-container>
      <mat-header-row class="p-4" style="min-height: 42px" *matHeaderRowDef="columns"></mat-header-row>
      <mat-row *matRowDef="let item; columns: columns" class="p-4"> </mat-row>
      <div class="no-data" *matNoDataRow>
        <ng-container *ngIf="!tableDs.loading; else loadingDiv"> Kayıt yok </ng-container>
      </div>
    </mat-table>
    <ng-container [ngTemplateOutlet]="paginator"></ng-container>
    <mat-menu #actions="matMenu" xPosition="before">
      <ng-template matMenuContent let-item="item">
        <div class="menu-item" (click)="onEditClick(item)">
          <span>Düzenle</span>
        </div>
        <div *ngIf="!item.areaCount" class="menu-item" (click)="onDeleteClick(item)">
          <span>Sil</span>
        </div>
      </ng-template>
    </mat-menu>
  </div>
</div>

<ng-template #paginator>
  <div class="paginator-row">
    <div class="loading">
      <mat-spinner [diameter]="16" *ngIf="tableDs.loading && tableDs.total > 0"></mat-spinner>
    </div>
    <mat-paginator
      showFirstLastButtons
      [disabled]="tableDs.loading"
      [length]="tableDs.total"
      [pageSize]="tableDs.size"
      [pageIndex]="tableDs.page - 1"
      [pageSizeOptions]="[10, 25, 50]"
      (page)="onPaginatorChanged($event)"
    >
    </mat-paginator>
  </div>
</ng-template>

<ng-template #loadingDiv>
  <mat-spinner [diameter]="16"></mat-spinner>
</ng-template>
